

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quickstart &mdash; PYFI 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/override.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon2.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Architecture" href="../architecture/index.html" />
    <link rel="prev" title="Install" href="../install/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #abbcc3" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/pyfi-mono.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../designgoals/index.html">Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Install</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bringing-up-the-stack">Bringing up the Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-pyfi-cli">Configuring PYFI CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialize-the-database">Initialize the Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-pyfi-cli">The PYFI CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-your-first-flow">Creating Your First Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-sockets">Creating Sockets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-socket-functions">Defining Socket Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#executing-socket-functions">Executing Socket Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-parallel-workflow">Running a Parallel Workflow</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technology</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../servers/index.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CLI/index.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/index.html">UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stack/index.html">Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../discord/index.html">Discord</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PYFI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/quickstart/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="bringing-up-the-stack">
<h2>Bringing up the Stack<a class="headerlink" href="#bringing-up-the-stack" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker-compose up
</pre></div>
</div>
</div>
<div class="section" id="configuring-pyfi-cli">
<h2>Configuring PYFI CLI<a class="headerlink" href="#configuring-pyfi-cli" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pyfi --config
Database connection URI <span class="o">[</span>postgresql://postgres:pyfi101@phoenix:5432/pyfi<span class="o">]</span>:
Result backend URI <span class="o">[</span>redis://localhost<span class="o">]</span>:
Message broker URI <span class="o">[</span>pyamqp://localhost<span class="o">]</span>:
Configuration file created at /home/user/pyfi.ini
</pre></div>
</div>
</div>
<div class="section" id="initialize-the-database">
<h2>Initialize the Database<a class="headerlink" href="#initialize-the-database" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pyfi db init
Enabling security on table action
Enabling security on table event
Enabling security on table flow
Enabling security on table <span class="nb">jobs</span>
Enabling security on table log
Enabling security on table privilege
Enabling security on table queue
Enabling security on table queuelog
Enabling security on table role
Enabling security on table scheduler
Enabling security on table settings
Enabling security on table task
Enabling security on table user
Enabling security on table node
Enabling security on table processor
Enabling security on table role_privileges
Enabling security on table user_privileges
Enabling security on table user_roles
Enabling security on table agent
Enabling security on table plug
Enabling security on table socket
Enabling security on table call
Enabling security on table plugs_queues
Enabling security on table plugs_source_sockets
Enabling security on table plugs_target_sockets
Enabling security on table sockets_queues
Enabling security on table worker
Enabling security on table calls_events
Database create all schemas <span class="k">done</span>.
</pre></div>
</div>
</div>
<div class="section" id="the-pyfi-cli">
<h2>The PYFI CLI<a class="headerlink" href="#the-pyfi-cli" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pyfi
Usage: pyfi <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...

Pyfi CLI <span class="k">for</span> managing the pyfi network

Options:
--debug         Debug switch
-d, --db TEXT   Database URI
--backend TEXT  Task queue backend
--broker TEXT   Message broker URI
-i, --ini TEXT  PYFI .ini configuration file
-c, --config    Configure pyfi
--help          Show this message and exit.

Commands:
add        Add an object to the database
agent      Run pyfi agent
api        API server admin
db         Database operations
delete     Delete an object from the database
listen     Listen to a processor output
ls         List database objects and their relations
node       Node management operations
proc       Run or manage processors
scheduler  Scheduler management commands
task       Pyfi task management
update     Update a database object
web        Web server admin
whoami     Database login user
worker     Run pyfi worker
</pre></div>
</div>
</div>
<div class="section" id="creating-your-first-flow">
<h2>Creating Your First Flow<a class="headerlink" href="#creating-your-first-flow" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at the sequence of CLI commands needed to build out our flow infrastructure and execute a task. From scratch!
First thing we do below is create a queue. This provides the persistent message broker the definition it needs to allocate a <code class="docutils literal notranslate"><span class="pre">message</span> <span class="pre">queue</span></code> by the same name for holding task messages.</p>
<p>Next we create a processor, which refers to our gitrepo and defines the module within that codebase we want to expose. It also defines the host where the processor should be run, but that is optional.
We specific a concurrency value of 5 that indicates <em>the scale</em> for our processor. This means it will seek to occupy 5 CPUs, allowing it to run in parallel and respond to high-volume message traffic better.</p>
<p>Then we create sockets and attach them to our processor. The socket tells pyfi what specific python function we want to receive messages for and what queue it should use. Lastly, it indicates what processor to be attached to.</p>
<p>Finally, we can run our task and get the result.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pyfi add queue -n pyfi.queue1 -t direct
$ pyfi add processor -n proc1 -g https://github.com/radiantone/pyfi-processors -m pyfi.processors.sample -h localhost -c <span class="m">5</span>
$ pyfi add socket -n pyfi.processors.sample.do_something -q pyfi.queue1 -pn proc1 -t do_something
$ pyfi add socket -n pyfi.processors.sample.do_this -q pyfi.queue1 -pn proc1 -t do_this
$ pyfi task run --socket pyfi.processors.sample.do_this --data <span class="s2">&quot;[&#39;some data&#39;]&quot;</span>
Do this: <span class="o">[</span><span class="s1">&#39;some data&#39;</span><span class="o">]</span>
</pre></div>
</div>
<div class="section" id="creating-sockets">
<h3>Creating Sockets<a class="headerlink" href="#creating-sockets" title="Permalink to this headline">¶</a></h3>
<p>Sockets represent addressable endpoints for python functions hosted by a processor. Remember, the processor points to a gitrepo and defines a python module within that repo.
The socket defines the task (or python function) within the processor python module. Thus, a single processor can have many sockets associated with it. Sockets also declare a queue they will use to pull their requests from.
This allows calls to tasks to be durable and reliable.</p>
<p>The following extract from the above flow defines a socket, gives it a name <code class="docutils literal notranslate"><span class="pre">pyfi.processors.sample.do_something</span></code>, declares the queue <code class="docutils literal notranslate"><span class="pre">pyfi.queue1</span></code>, associates it with processor named <code class="docutils literal notranslate"><span class="pre">proc1</span></code> and represents the python function/task <code class="docutils literal notranslate"><span class="pre">do_something</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pyfi add socket -n pyfi.processors.sample.do_something -q pyfi.queue1 -pn proc1 -t do_something
</pre></div>
</div>
</div>
<div class="section" id="defining-socket-functions">
<h3>Defining Socket Functions<a class="headerlink" href="#defining-socket-functions" title="Permalink to this headline">¶</a></h3>
<p>Once you’ve built out your flow and infrastructure to support it, you can create convenient types that represent your python functions via the Socket class.</p>
<p>For the parallel flow above, we import the .p (or partial) signature from this file, which comes from our Socket we created earlier named <code class="docutils literal notranslate"><span class="pre">pyfi.processors.sample.do_something</span></code>.
Remember, the socket captures the module (from its parent Processor) and function name within that module you want to run. Think of it like an endpoint with a queue in front of it.</p>
<p>We take one step further in the file below and rename Socket class to Function simply as a linguistic preference in this context.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyfi.client.api</span> <span class="kn">import</span> <span class="n">Socket</span> <span class="k">as</span> <span class="n">Function</span>

<span class="n">do_something</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pyfi.processors.sample.do_something&#39;</span><span class="p">)</span>
<span class="n">do_something_p</span> <span class="o">=</span> <span class="n">do_something</span><span class="o">.</span><span class="n">p</span>

<span class="n">do_this</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pyfi.processors.sample.do_this&#39;</span><span class="p">)</span>
<span class="n">do_this_p</span> <span class="o">=</span> <span class="n">do_this</span><span class="o">.</span><span class="n">p</span>
</pre></div>
</div>
<p>Once we’ve created our function definitions above, we can use them like normal python functions as in the parallel workflow below!</p>
</div>
<div class="section" id="executing-socket-functions">
<h3>Executing Socket Functions<a class="headerlink" href="#executing-socket-functions" title="Permalink to this headline">¶</a></h3>
<p>Executing socket functions from python is very easy. Since we can create the socket ahead of time, we only need to refer to it by name as above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyfi.client.api</span> <span class="kn">import</span> <span class="n">Socket</span> <span class="k">as</span> <span class="n">Function</span>

<span class="n">do_something</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pyfi.processors.sample.do_something&#39;</span><span class="p">)</span>
<span class="n">do_something_p</span> <span class="o">=</span> <span class="n">do_something</span><span class="o">.</span><span class="n">p</span>
</pre></div>
</div>
<p>The just invoke the function reference as you normally would. If you are using the function within a parallel API structure such as <code class="docutils literal notranslate"><span class="pre">parallel</span></code>, <code class="docutils literal notranslate"><span class="pre">pipeline</span></code>, <code class="docutils literal notranslate"><span class="pre">funnel</span></code> etc then you should use the <code class="docutils literal notranslate"><span class="pre">partial</span></code> version of the function signature.
This allows PYFI to add arguments to the task when it is invoked. The invocation is deferred so it doesn’t happen at the time you declare your workflow. The reason is because your task will execute on thos remote CPU at a time when the workflow reaches that task.
So the .p partial is a <code class="docutils literal notranslate"><span class="pre">signature</span></code> for your task in that respect.</p>
<p>However, if you simply want to execute your task and control the execution flow yourself, you can use the Function reference or <cite>do_something</cite> in the above code fragment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Some text!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For readability its customary to remap the partial signature as in the workflow below.</p>
</div>
</div>
<div class="section" id="running-a-parallel-workflow">
<h2>Running a Parallel Workflow<a class="headerlink" href="#running-a-parallel-workflow" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyfi.client.api</span> <span class="kn">import</span> <span class="n">parallel</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">funnel</span>
<span class="kn">from</span> <span class="nn">pyfi.client.example.api</span> <span class="kn">import</span> <span class="n">do_something_p</span> <span class="k">as</span> <span class="n">do_something</span>

<span class="c1"># Create a pipeline that executes tasks sequentially, passing result to next task</span>
<span class="n">_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">([</span>
   <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;One&quot;</span><span class="p">),</span>
   <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Two&quot;</span><span class="p">),</span>
   <span class="c1"># Create a parallel structure that executes tasks in parallel and returns the</span>
   <span class="c1"># result list</span>
   <span class="n">parallel</span><span class="p">([</span>
      <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Four&quot;</span><span class="p">),</span>
      <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Five&quot;</span><span class="p">),</span>
   <span class="p">]),</span>
   <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Three&quot;</span><span class="p">)])</span>

<span class="c1"># Create another parallel structure using the above pipeline as one of its tasks</span>
<span class="n">_parallel</span> <span class="o">=</span> <span class="n">parallel</span><span class="p">([</span>
   <span class="n">_pipeline</span><span class="p">,</span>
   <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Six&quot;</span><span class="p">),</span>
   <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Seven&quot;</span><span class="p">)])</span>

<span class="c1"># Create a funnel structure that executes all its tasks passing the result to the</span>
<span class="c1"># single, final task</span>
<span class="n">_funnel</span> <span class="o">=</span> <span class="n">funnel</span><span class="p">([</span>
   <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Eight&quot;</span><span class="p">),</span>
   <span class="n">_parallel</span><span class="p">,</span>
   <span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Nine&quot;</span><span class="p">)])</span>

<span class="c1"># Gather the result from the _funnel and send it to do_something(&quot;Four&quot;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FUNNEL: &quot;</span><span class="p">,</span> <span class="n">_funnel</span><span class="p">(</span><span class="n">do_something</span><span class="p">(</span><span class="s2">&quot;Four&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../architecture/index.html" class="btn btn-neutral float-right" title="Architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../install/index.html" class="btn btn-neutral float-left" title="Install" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Darren Govoni.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>